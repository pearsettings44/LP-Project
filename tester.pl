output: [[ilha(2,(1,1)),[ilha(2,(1,3)),ilha(6,(3,1))],[]],
[ilha(2,(1,3)),[ilha(2,(1,1)),ilha(5,(1,5)),ilha(3,(3,3))],[]],
[ilha(5,(1,5)),[ilha(2,(1,3)),ilha(2,(1,7)),ilha(6,(4,5))],[]],
[ilha(2,(1,7)),[ilha(5,(1,5)),ilha(1,(4,7))],[]],
[ilha(1,(2,6)),[ilha(3,(2,8)),ilha(2,(5,6))],[]],
[ilha(3,(2,8)),[ilha(1,(2,6)),ilha(6,(5,8))],[]],
[ilha(6,(3,1)),[ilha(2,(1,1)),ilha(3,(3,3)),ilha(3,(5,1))],[]],
[ilha(3,(3,3)),[ilha(2,(1,3)),ilha(6,(3,1)),ilha(1,(5,3))],[]],
[ilha(2,(4,2)),[ilha(6,(4,5)),ilha(2,(6,2))],[ponte((4,2),(6,2))]],
[ilha(6,(4,5)),[ilha(5,(1,5)),ilha(2,(4,2)),ilha(1,(4,7)),ilha(5,(7,5))],[]],
[ilha(1,(4,7)),[ilha(2,(1,7)),ilha(6,(4,5)),ilha(2,(8,7))],[]],
[ilha(3,(5,1)),[ilha(6,(3,1)),ilha(1,(7,1))],[]],
[ilha(1,(5,3)),[ilha(3,(3,3)),ilha(2,(5,6)),ilha(3,(7,3))],[]],
[ilha(2,(5,6)),[ilha(1,(2,6)),ilha(1,(5,3)),ilha(6,(5,8))],[]],
[ilha(6,(5,8)),[ilha(3,(2,8)),ilha(2,(5,6)),ilha(3,(7,8))],[]],
[ilha(2,(6,2)),[ilha(2,(4,2)),ilha(2,(8,2))],[ponte((4,2),(6,2))]],
[ilha(1,(7,1)),[ilha(3,(5,1)),ilha(3,(7,3))],[]],
[ilha(3,(7,3)),[ilha(1,(5,3)),ilha(1,(7,1)),ilha(5,(7,5))],[]],
[ilha(5,(7,5)),[ilha(6,(4,5)),ilha(3,(7,3)),ilha(3,(7,8))],[]],
[ilha(3,(7,8)),[ilha(6,(5,8)),ilha(5,(7,5))],[]],
[ilha(2,(8,2)),[ilha(2,(6,2)),ilha(3,(8,4))],[]],
[ilha(3,(8,4)),[ilha(2,(8,2)),ilha(2,(8,7))],[]],
[ilha(2,(8,7)),[ilha(1,(4,7)),ilha(3,(8,4))],[]]]



[[ilha(2,(1,1)),[ilha(2,(1,3)),ilha(6,(3,1))],[]],[ilha(2,(1,3)),[ilha(2,(1,1)),ilha(5,(1,5)),ilha(3,(3,3))],[]],[ilha(5,(1,5)),[ilha(2,(1,3)),ilha(2,(1,7)),ilha(6,(4,5))],[]],[ilha(2,(1,7)),[ilha(5,(1,5)),ilha(1,(4,7))],[]],[ilha(1,(2,6)),[ilha(3,(2,8)),ilha(2,(5,6))],[]],[ilha(3,(2,8)),[ilha(1,(2,6)),ilha(6,(5,8))],[]],[ilha(6,(3,1)),[ilha(2,(1,1)),ilha(3,(3,3)),ilha(3,(5,1))],[]],[ilha(3,(3,3)),[ilha(2,(1,3)),ilha(6,(3,1)),ilha(1,(5,3))],[]],[ilha(2,(4,2)),[ilha(6,(4,5)),ilha(2,(6,2))],[]],[ilha(6,(4,5)),[ilha(5,(1,5)),ilha(2,(4,2)),ilha(1,(4,7)),ilha(5,(7,5))],[]],[ilha(1,(4,7)),[ilha(2,(1,7)),ilha(6,(4,5)),ilha(2,(8,7))],[]],[ilha(3,(5,1)),[ilha(6,(3,1)),ilha(1,(5,3)),ilha(1,(7,1))],[]],[ilha(1,(5,3)),[ilha(3,(3,3)),ilha(3,(5,1)),ilha(2,(5,6)),ilha(3,(7,3))],[]],[ilha(2,(5,6)),[ilha(1,(2,6)),ilha(1,(5,3)),ilha(6,(5,8))],[]],[ilha(6,(5,8)),[ilha(3,(2,8)),ilha(2,(5,6)),ilha(3,(7,8))],[]],[ilha(2,(6,2)),[ilha(2,(4,2)),ilha(2,(8,2))],[]],[ilha(1,(7,1)),[ilha(3,(5,1)),ilha(3,(7,3))],[]],[ilha(3,(7,3)),[ilha(1,(5,3)),ilha(1,(7,1)),ilha(5,(7,5))],[]],[ilha(5,(7,5)),[ilha(6,(4,5)),ilha(3,(7,3)),ilha(3,(7,8))],[]],[ilha(3,(7,8)),[ilha(6,(5,8)),ilha(5,(7,5))],[]],[ilha(2,(8,2)),[ilha(2,(6,2)),ilha(3,(8,4))],[]],[ilha(3,(8,4)),[ilha(2,(8,2)),ilha(2,(8,7))],[]],[ilha(2,(8,7)),[ilha(1,(4,7)),ilha(3,(8,4))],[]]]
[[ilha(2,(1,1)),[ilha(2,(1,3)),ilha(6,(3,1))],[]],[ilha(2,(1,3)),[ilha(2,(1,1)),ilha(5,(1,5)),ilha(3,(3,3))],[]],[ilha(5,(1,5)),[ilha(2,(1,3)),ilha(2,(1,7)),ilha(6,(4,5))],[]],[ilha(2,(1,7)),[ilha(5,(1,5)),ilha(1,(4,7))],[]],[ilha(1,(2,6)),[ilha(3,(2,8)),ilha(2,(5,6))],[]],[ilha(3,(2,8)),[ilha(1,(2,6)),ilha(6,(5,8))],[]],[ilha(6,(3,1)),[ilha(2,(1,1)),ilha(3,(3,3)),ilha(3,(5,1))],[]],[ilha(3,(3,3)),[ilha(2,(1,3)),ilha(6,(3,1)),ilha(1,(5,3))],[]],[[ilha(2,(4,2)),[ilha(6,(4,5)),ilha(2,(6,2))],[ponte((4,2),(6,2))]]],[ilha(6,(4,5)),[ilha(5,(1,5)),ilha(2,(4,2)),ilha(1,(4,7)),ilha(5,(7,5))],[]],[ilha(1,(4,7)),[ilha(2,(1,7)),ilha(6,(4,5)),ilha(2,(8,7))],[]],[ilha(3,(5,1)),[ilha(6,(3,1)),ilha(1,(5,3)),ilha(1,(7,1))],[]],[ilha(1,(5,3)),[ilha(3,(3,3)),ilha(3,(5,1)),ilha(2,(5,6)),ilha(3,(7,3))],[]],[ilha(2,(5,6)),[ilha(1,(2,6)),ilha(1,(5,3)),ilha(6,(5,8))],[]],[ilha(6,(5,8)),[ilha(3,(2,8)),ilha(2,(5,6)),ilha(3,(7,8))],[]],[[ilha(2,(6,2)),[ilha(2,(4,2)),ilha(2,(8,2))],[ponte((4,2),(6,2))]]],[ilha(1,(7,1)),[ilha(3,(5,1)),ilha(3,(7,3))],[]],[ilha(3,(7,3)),[ilha(1,(5,3)),ilha(1,(7,1)),ilha(5,(7,5))],[]],[ilha(5,(7,5)),[ilha(6,(4,5)),ilha(3,(7,3)),ilha(3,(7,8))],[]],[ilha(3,(7,8)),[ilha(6,(5,8)),ilha(5,(7,5))],[]],[ilha(2,(8,2)),[ilha(2,(6,2)),ilha(3,(8,4))],[]],[ilha(3,(8,4)),[ilha(2,(8,2)),ilha(2,(8,7))],[]],[ilha(2,(8,7)),[ilha(1,(4,7)),ilha(3,(8,4))],[]]]
[[ilha(2,(1,1)),[ilha(2,(1,3)),ilha(6,(3,1))],[]],[ilha(2,(1,3)),[ilha(2,(1,1)),ilha(5,(1,5)),ilha(3,(3,3))],[]],[ilha(5,(1,5)),[ilha(2,(1,3)),ilha(2,(1,7)),ilha(6,(4,5))],[]],[ilha(2,(1,7)),[ilha(5,(1,5)),ilha(1,(4,7))],[]],[ilha(1,(2,6)),[ilha(3,(2,8)),ilha(2,(5,6))],[]],[ilha(3,(2,8)),[ilha(1,(2,6)),ilha(6,(5,8))],[]],[ilha(6,(3,1)),[ilha(2,(1,1)),ilha(3,(3,3)),ilha(3,(5,1))],[]],[ilha(3,(3,3)),[ilha(2,(1,3)),ilha(6,(3,1)),ilha(1,(5,3))],[]],[[ilha(2,(4,2)),[ilha(6,(4,5)),ilha(2,(6,2))],[ponte((4,2),(6,2))]]],[ilha(6,(4,5)),[ilha(5,(1,5)),ilha(2,(4,2)),ilha(1,(4,7)),ilha(5,(7,5))],[]],[ilha(1,(4,7)),[ilha(2,(1,7)),ilha(6,(4,5)),ilha(2,(8,7))],[]],[ilha(3,(5,1)),[ilha(6,(3,1)),ilha(1,(5,3)),ilha(1,(7,1))],[]],[ilha(1,(5,3)),[ilha(3,(3,3)),ilha(3,(5,1)),ilha(2,(5,6)),ilha(3,(7,3))],[]],[ilha(2,(5,6)),[ilha(1,(2,6)),ilha(1,(5,3)),ilha(6,(5,8))],[]],[ilha(6,(5,8)),[ilha(3,(2,8)),ilha(2,(5,6)),ilha(3,(7,8))],[]],[[ilha(2,(6,2)),[ilha(2,(4,2)),ilha(2,(8,2))],[ponte((4,2),(6,2))]]],[ilha(1,(7,1)),[ilha(3,(5,1)),ilha(3,(7,3))],[]],[ilha(3,(7,3)),[ilha(1,(5,3)),ilha(1,(7,1)),ilha(5,(7,5))],[]],[ilha(5,(7,5)),[ilha(6,(4,5)),ilha(3,(7,3)),ilha(3,(7,8))],[]],[ilha(3,(7,8)),[ilha(6,(5,8)),ilha(5,(7,5))],[]],[ilha(2,(8,2)),[ilha(2,(6,2)),ilha(3,(8,4))],[]],[ilha(3,(8,4)),[ilha(2,(8,2)),ilha(2,(8,7))],[]],[ilha(2,(8,7)),[ilha(1,(4,7)),ilha(3,(8,4))],[]]]

% ------------------------------------------------------------------------------
% junta_pontes(Estado, Num_pontes, Ilha1, Ilha2, Novo_estado)
% Novo_estado eh o estado que se obtem por adicao de Num_pontes pontes
% entre Ilha1 e Ilha2.
% ------------------------------------------------------------------------------

adiciona_pontes_aux(_,_,_, [], []).

adiciona_pontes_aux(Ponte, Ilha1, Ilha2, [ Entrada | R], [ [Ilha1, Vz, [Ponte]] |EstadoComPonte]) :-
    Entrada = [Ilha , Vz , _],
    Ilha == Ilha1,
    adiciona_pontes_aux(Ponte, Ilha1, Ilha2, R, EstadoComPonte).

adiciona_pontes_aux(Ponte, Ilha1, Ilha2, [ Entrada | R], [ [Ilha2, Vz, [Ponte]] |EstadoComPonte]) :-
    Entrada = [Ilha , Vz , _],
    Ilha == Ilha2,
    adiciona_pontes_aux(Ponte, Ilha1, Ilha2, R, EstadoComPonte).

adiciona_pontes_aux(Ponte, Ilha1, Ilha2, [ Entrada | R], EstadoComPonte) :-
    Entrada = [Ilha , _ , _],
    Ilha \== Ilha1,
    Ilha \== Ilha2,
    adiciona_pontes_aux(Ponte, Ilha1, Ilha2, R, EstadoComPonte).

adiciona_pontes(Ponte, Ilha1, Ilha2, Estado, EstadoComPonte) :-
    adiciona_pontes_aux(Ponte, Ilha1, Ilha2, Estado, EstadoComPonte).



substitui_entradas_pontes(Estado, PontesAdicionadas, EstadoComPontes) :-
    maplist(substitui_entradas_pontes_aux(PontesAdicionadas), Estado, EstadoComPontes).

substitui_entradas_pontes_aux(PontesAdicionadas, Entrada, EntradaNova) :-
    Entrada = [Ilha, _, _],
    member([Ilha, _, _], PontesAdicionadas),
    findall(X, (member(X,PontesAdicionadas), X = [Ilha, _ , _]), EntradaNova).

substitui_entradas_pontes_aux(PontesAdicionadas, Entrada, EntradaNova) :-
    Entrada = [Ilha, _, _],
    \+ member([Ilha, _, _], PontesAdicionadas),
    EntradaNova = Entrada.


mesma_ilha_ponte_aux(_, [], []).

mesma_ilha_ponte_aux(EntradaSemPonte, [P | R], EntradaComPonte) :-
    EntradaSemPonte = [Ilha, _, _],
    member(Ilha, P),
    mesma_ilha_ponte_aux(EntradaSemPonte, R, EntradaComPonte).


mesma_ilha_ponte(EntradaSemPonte, EntradasComPontes, EntradaComPonte) :-
    EntradaSemPonte = [Ilha, _, _],
    mesma_ilha_ponte_aux(Ilha, EntradasComPontes, EntradaComPonte).


junta_pontes(Estado, Num_pontes, Ilha1, Ilha2, Novo_estado) :-
    Ilha1 = ilha(_, Pos1),
    Ilha2 = ilha(_, Pos2),
    cria_ponte(Pos1, Pos2, Ponte),
    adiciona_pontes(Ponte, Ilha1, Ilha2, Estado, PontesAdicionadas),
    substitui_entradas_pontes(Estado, PontesAdicionadas, EstadoComPontes),
    actualiza_vizinhas_apos_pontes(EstadoComPontes, Pos1, Pos2, EstadoActualizado).
    %writeln(EstadoAtualizado),nl,
    %trata_ilhas_terminadas(EstadoAtualizado, Novo_estado),
    %writeln(Novo_estado).
